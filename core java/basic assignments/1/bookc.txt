package com.casestudy;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

@RestController
@RequestMapping("/booking")
public class bookController {

	RestTemplate resttemplate= new RestTemplate();
	@Autowired
	bookingService b;
	
	@PostMapping("/add")
	public booking addnew(@RequestBody booking n)
	{
	
int a=n.getPassengers().size();
		
		resttemplate.put("http://localhost:8082/train/book/"+n.getTrainname()+"/"+n.getDate()+"/"+n.getReservationtype()+"/"+a,booking.class);
		return b.add(n);	
	}
	
	@GetMapping("/all")
	public List<booking> show()
	{
	return b.showall();	
	}
	@GetMapping("/getuser/{username}")
	public List<booking> getbyusername(@PathVariable("username")String username)
	{
	return b.getbyuser(username);	
	}
	@DeleteMapping("/del/{name}")
	public void del(@PathVariable("name")String name)
	{
		b.deletebyname(name);
	}
	@GetMapping("/getpnr/{pnr}")
	public booking getbypnr(@PathVariable("pnr")String pnr)
	{
	return b.getbypnr(pnr);	
	}
	
}
